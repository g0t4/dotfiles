THIS CODE IS FROM neovim

Apache 2.0
Here is neovim's license:
https://github.com/neovim/neovim/blob/master/LICENSE.txt
